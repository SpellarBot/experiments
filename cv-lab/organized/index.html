<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Blob Detection JS</title>
        <meta name="viewport" content="width=device-width" />

		<!-- rss feed -->
		<link rel="alternate" type="application/rss+xml" title="RSS"
			href="http://blog.acipo.com/feed.xml" />

		<!-- important seo meta tags ? -->
		<meta name="description" content="" />
		<meta name="keywords" content="image processing blob detection js" />
		<meta name="author" content="Andrew Ippoliti" />

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css"/>

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/reset.css"/>
        <link rel="stylesheet" href="/css/main.css"/>

		<style type="text/css">
			.input-parameters-block, canvas { border: 1px solid #000; display:inline-block; }
			.input-parameters-block { width: 320px; height: 320px; vertical-align: top; }
			.slider-group { text-align: right; }
			.slider-group label, .slider-group input { vertical-align: middle; }
		</style>

    </head>
    <body style="text-align:center">

<canvas id="canvas-original" width="320" height="320" ></canvas>

<script type="text/javascript" src="cv-lab-full.js"></script>
<script type="text/javascript">
var debounce = function(func, wait, immediate) {
	var timeout;
	return function() {
		var context = this, args = arguments;
		var later = function() {
			timeout = null;
			if (!immediate) func.apply(context, args);
		};
		var callNow = immediate && !timeout;
		clearTimeout(timeout);
		timeout = setTimeout(later, wait);
		if (callNow) func.apply(context, args);
	};
};
function canvasCopy( srcCanvas, dstCanvas ){
	var srcCtx = srcCanvas.getContext('2d'),
	    dstCtx = dstCanvas.getContext('2d'),
	    srcPix = srcCtx.getImageData(0,0,srcCanvas.width,srcCanvas.height);

	dstCtx.putImageData( srcPix, 0, 0 );
}

function runImageThingy( srcCanvas, dstCanvas, action ){

    var srcCtx = srcCanvas.getContext('2d');
	var srcPix = srcCtx.getImageData(0,0,srcCanvas.width,srcCanvas.height);
    var dstCtx = dstCanvas.getContext('2d');
	var dstPix = dstCtx.getImageData(0,0,dstCanvas.width,dstCanvas.height);
    
	dstPix = action( srcPix );
	dstCtx.putImageData( dstPix, 0, 0 );
}
</script>
<script type="text/javascript">

function generateHsvTestCanvas( dst ){
	var xSize = dst.width,
	    ySize = dst.height,
	    dstPixels = dst.data;

	var xPartSize = Math.floor(xSize/2.0),
	    yPartSize = Math.floor(ySize/2.0);

	var x,y,pos, h,s,v, rgba;

	// Top left quadrant: hue sweep left-to-right, saturation sweep top-down, value = 0.25
	v = 64;
	for( x=0; x<xPartSize; x+=1 ){
		for( y=0; y<yPartSize; y+=1 ){
			pos = (y*xSize+x)*4;

			h = Math.round(255.0*x/xPartSize);
			s = Math.round(255.0*y/yPartSize);

			rgba = CvLab.converter.hsvaToRgba([h,s,v,255]);

			dstPixels[pos+0] = rgba[0];
			dstPixels[pos+1] = rgba[1];
			dstPixels[pos+2] = rgba[2];
			dstPixels[pos+3] = rgba[3];
		}
	}

	// Top right quadrant: hue sweep left-to-right, saturation sweep top-down, value = 0.75
	v = 192;
	for( x=xPartSize; x<xSize; x+=1 ){
		for( y=0; y<yPartSize; y+=1 ){
			pos = (y*xSize+x)*4;

			h = Math.round(255.0*(x-xPartSize)/xPartSize);
			s = Math.round(255.0*y/yPartSize);

			rgba = CvLab.converter.hsvaToRgba([h,s,v,255]);

			dstPixels[pos+0] = rgba[0];
			dstPixels[pos+1] = rgba[1];
			dstPixels[pos+2] = rgba[2];
			dstPixels[pos+3] = rgba[3];
		}
	}

	// Bottom left quadrant: hue sweep left-to-right, value sweep top-down, saturation = 0.25
	s = 64;
	for( x=0; x<xPartSize; x+=1 ){
		for( y=yPartSize; y<ySize; y+=1 ){
			pos = (y*xSize+x)*4;

			h = Math.round(255.0*x/xPartSize);
			v = Math.round(255.0*(y-yPartSize)/yPartSize);

			rgba = CvLab.converter.hsvaToRgba([h,s,v,255]);

			dstPixels[pos+0] = rgba[0];
			dstPixels[pos+1] = rgba[1];
			dstPixels[pos+2] = rgba[2];
			dstPixels[pos+3] = rgba[3];
		}
	}

	// Bottom right quadrant: hue sweep left-to-right, value sweep top-down, saturation = 0.25
	s = 192;
	for( x=xPartSize; x<xSize; x+=1 ){
		for( y=yPartSize; y<ySize; y+=1 ){
			pos = (y*xSize+x)*4;

			h = Math.round(255.0*(x-xPartSize)/xPartSize);
			v = Math.round(255.0*(y-yPartSize)/yPartSize);

			rgba = CvLab.converter.hsvaToRgba([h,s,v,255]);

			dstPixels[pos+0] = rgba[0];
			dstPixels[pos+1] = rgba[1];
			dstPixels[pos+2] = rgba[2];
			dstPixels[pos+3] = rgba[3];
		}
	}
}

onload = function(){

    var cvsOriginal = document.getElementById('canvas-original');
    var ctxOriginal = cvsOriginal.getContext('2d');
    var pixOriginal = ctxOriginal.getImageData(0,0,cvsOriginal.width,cvsOriginal.height);
	generateHsvTestCanvas( pixOriginal );
	ctxOriginal.putImageData(pixOriginal,0,0);

	// Copy the original to all of the other inputs
	canvasCopy( cvsOriginal, document.getElementById('image-adjust-brightness-src') );
	canvasCopy( cvsOriginal, document.getElementById('image-adjust-contrast-src') );
	canvasCopy( cvsOriginal, document.getElementById('image-adjust-hsva-src') );
	canvasCopy( cvsOriginal, document.getElementById('image-adjust-rgba-src') );
	canvasCopy( cvsOriginal, document.getElementById('image-convert-hsva-to-rgba-src') );
	canvasCopy( cvsOriginal, document.getElementById('image-convert-rgba-to-hsva-src') );
	canvasCopy( cvsOriginal, document.getElementById('image-convert-rgba-to-luma-src') );
	canvasCopy( cvsOriginal, document.getElementById('image-convert-to-max-channel-src') );
	canvasCopy( cvsOriginal, document.getElementById('image-convert-to-min-channel-src') );
	canvasCopy( cvsOriginal, document.getElementById('image-invert-src') );
	canvasCopy( cvsOriginal, document.getElementById('image-channel-extract-src') );
	//canvasCopy( cvsOriginal, document.getElementById('image-erode-src') );

};

</script>


<!-- image-convert-rgba-to-luma.yaml -->

<section id="section-image-convert-rgba-to-luma">
	<h2>Convert RGBA To Luma</h2>
	<div class="input-parameters-block" id="input-image-convert-rgba-to-luma">
		<p>Converts an image whose 4 channels represent: red, green, blue, and alpha to an image whose 4 channels represent: luma, luma, luma, and alpha. https://en.wikipedia.org/wiki/Luma_(video)
</p>
		<button id="image-convert-rgba-to-luma-reset">Reset</button>

	</div>
	<canvas id="image-convert-rgba-to-luma-src" width="320" height="320" ></canvas>
	<canvas id="image-convert-rgba-to-luma-dst" width="320" height="320" ></canvas>

	<script type="text/javascript">
		function imageConvertRgbaToLumaRun(){
			runImageThingy( document.getElementById("image-convert-rgba-to-luma-src"), document.getElementById("image-convert-rgba-to-luma-dst"), function(src,dst){
				return CvLab.image.convertRgbaToLuma( src );
 			});
		}
		function imageConvertRgbaToLumaReset(){
			imageConvertRgbaToLumaRun();
		}
		document.getElementById("input-image-convert-rgba-to-luma").onmousemove = imageConvertRgbaToLumaRun;
		document.getElementById("image-convert-rgba-to-luma-reset").onclick = imageConvertRgbaToLumaReset;
	</script>
</section>

<!-- image-convert-hsva-to-rgba.yaml -->

<section id="section-image-convert-hsva-to-rgba">
	<h2>Convert HSVA To RGBA</h2>
	<div class="input-parameters-block" id="input-image-convert-hsva-to-rgba">
		<p>Converts an image whose 4 channels represent: hue, saturation, value, and alpha to an image whose 4 channels represent: red, green, bluse and alpha.
</p>
		<button id="image-convert-hsva-to-rgba-reset">Reset</button>

	</div>
	<canvas id="image-convert-hsva-to-rgba-src" width="320" height="320" ></canvas>
	<canvas id="image-convert-hsva-to-rgba-dst" width="320" height="320" ></canvas>

	<script type="text/javascript">
		function imageConvertHsvaToRgbaRun(){
			runImageThingy( document.getElementById("image-convert-hsva-to-rgba-src"), document.getElementById("image-convert-hsva-to-rgba-dst"), function(src,dst){
				return CvLab.image.convertHsvaToRgba( src );
 			});
		}
		function imageConvertHsvaToRgbaReset(){
			imageConvertHsvaToRgbaRun();
		}
		document.getElementById("input-image-convert-hsva-to-rgba").onmousemove = imageConvertHsvaToRgbaRun;
		document.getElementById("image-convert-hsva-to-rgba-reset").onclick = imageConvertHsvaToRgbaReset;
	</script>
</section>

<!-- image-invert.yaml -->

<section id="section-image-invert">
	<h2>Invert</h2>
	<div class="input-parameters-block" id="input-image-invert">
		<p>Inverts all of the pixel values in the image except the alpha channel. It is equivalent to subtracting each pixel value from 255.
</p>
		<button id="image-invert-reset">Reset</button>

	</div>
	<canvas id="image-invert-src" width="320" height="320" ></canvas>
	<canvas id="image-invert-dst" width="320" height="320" ></canvas>

	<script type="text/javascript">
		function imageInvertRun(){
			runImageThingy( document.getElementById("image-invert-src"), document.getElementById("image-invert-dst"), function(src){
				return CvLab.image.invert( src );
 			});
		}
		function imageInvertReset(){
			imageInvertRun();
		}
		document.getElementById("input-image-invert").onmousemove = imageInvertRun;
		document.getElementById("image-invert-reset").onclick = imageInvertReset;
	</script>
</section>

<!-- image-convert-to-min-channel.yaml -->

<section id="section-image-convert-to-min-channel">
	<h2>Convert Image to Minimum Channel</h2>
	<div class="input-parameters-block" id="input-image-convert-to-min-channel">
		<p>Modifies the source image so that channels that do not have the minimum value for a pixel are set to 0. The alpha channel is ignored.
</p>
		<button id="image-convert-to-min-channel-reset">Reset</button>

	</div>
	<canvas id="image-convert-to-min-channel-src" width="320" height="320" ></canvas>
	<canvas id="image-convert-to-min-channel-dst" width="320" height="320" ></canvas>

	<script type="text/javascript">
		function imageConvertToMinChannelRun(){
			runImageThingy( document.getElementById("image-convert-to-min-channel-src"), document.getElementById("image-convert-to-min-channel-dst"), function(src){
				return CvLab.image.convertToMinChannel( src );
 			});
		}
		function imageConvertToMinChannelReset(){
			imageConvertToMinChannelRun();
		}
		document.getElementById("input-image-convert-to-min-channel").onmousemove = imageConvertToMinChannelRun;
		document.getElementById("image-convert-to-min-channel-reset").onclick = imageConvertToMinChannelReset;
	</script>
</section>

<!-- image-adjust-hsva.yaml -->

<section id="section-image-adjust-hsva">
	<h2>Adjusts the HSVA Values of an RGBA Image</h2>
	<div class="input-parameters-block" id="input-image-adjust-hsva">
		<p>Adds or subtracts the specified hue, saturation, value, and alpha values to
each pixel of the source image. This function assumes the source image is
in RGBA mode.
</p>

		<div class="slider-group">
			<label for="image-adjust-hsva-h" title="How much to adjust the hue">h</label>
			<input type="range" id="image-adjust-hsva-h" min="-255" max="255" step="1" />
		</div>

		<div class="slider-group">
			<label for="image-adjust-hsva-s" title="How much to adjust the saturation">s</label>
			<input type="range" id="image-adjust-hsva-s" min="-255" max="255" step="1" />
		</div>

		<div class="slider-group">
			<label for="image-adjust-hsva-v" title="How much to adjust the value">v</label>
			<input type="range" id="image-adjust-hsva-v" min="-255" max="255" step="1" />
		</div>

		<div class="slider-group">
			<label for="image-adjust-hsva-a" title="How much to adjust the alpha">a</label>
			<input type="range" id="image-adjust-hsva-a" min="-255" max="255" step="1" />
		</div>
		<button id="image-adjust-hsva-reset">Reset</button>

	</div>
	<canvas id="image-adjust-hsva-src" width="320" height="320" ></canvas>
	<canvas id="image-adjust-hsva-dst" width="320" height="320" ></canvas>

	<script type="text/javascript">
		function imageAdjustHsvaRun(){
			var h = parseFloat( document.getElementById("image-adjust-hsva-h").value );
			var s = parseFloat( document.getElementById("image-adjust-hsva-s").value );
			var v = parseFloat( document.getElementById("image-adjust-hsva-v").value );
			var a = parseFloat( document.getElementById("image-adjust-hsva-a").value );
			runImageThingy( document.getElementById("image-adjust-hsva-src"), document.getElementById("image-adjust-hsva-dst"), function(src){
				return CvLab.image.adjustHsva( src, h, s, v, a );
 			});
		}
		function imageAdjustHsvaReset(){
			document.getElementById("image-adjust-hsva-h").value = 0;
			document.getElementById("image-adjust-hsva-s").value = 0;
			document.getElementById("image-adjust-hsva-v").value = 0;
			document.getElementById("image-adjust-hsva-a").value = 0;
			imageAdjustHsvaRun();
		}
		document.getElementById("input-image-adjust-hsva").onmousemove = imageAdjustHsvaRun;
		document.getElementById("image-adjust-hsva-reset").onclick = imageAdjustHsvaReset;
	</script>
</section>

<!-- image-convert-to-max-channel.yaml -->

<section id="section-image-convert-to-max-channel">
	<h2>Convert Image to Maximum Channel</h2>
	<div class="input-parameters-block" id="input-image-convert-to-max-channel">
		<p>Modifies the source image so that channels that do not have the maximum value for a pixel are set to 0. The alpha channel is ignored.
</p>
		<button id="image-convert-to-max-channel-reset">Reset</button>

	</div>
	<canvas id="image-convert-to-max-channel-src" width="320" height="320" ></canvas>
	<canvas id="image-convert-to-max-channel-dst" width="320" height="320" ></canvas>

	<script type="text/javascript">
		function imageConvertToMaxChannelRun(){
			runImageThingy( document.getElementById("image-convert-to-max-channel-src"), document.getElementById("image-convert-to-max-channel-dst"), function(src){
				return CvLab.image.convertToMaxChannel( src );
 			});
		}
		function imageConvertToMaxChannelReset(){
			imageConvertToMaxChannelRun();
		}
		document.getElementById("input-image-convert-to-max-channel").onmousemove = imageConvertToMaxChannelRun;
		document.getElementById("image-convert-to-max-channel-reset").onclick = imageConvertToMaxChannelReset;
	</script>
</section>

<!-- image-adjust-brightness.yaml -->

<section id="section-image-adjust-brightness">
	<h2>Adjusts the Brightness</h2>
	<div class="input-parameters-block" id="input-image-adjust-brightness">
		<p>Makes the image darker or light. A positive brightness makes the image lighter (more white) while a negative brightness makes the image darker (more black).
</p>

		<div class="slider-group">
			<label for="image-adjust-brightness-brightness" title="How much to adjust the brightness">brightness</label>
			<input type="range" id="image-adjust-brightness-brightness" min="-255" max="255" step="1" />
		</div>
		<button id="image-adjust-brightness-reset">Reset</button>

	</div>
	<canvas id="image-adjust-brightness-src" width="320" height="320" ></canvas>
	<canvas id="image-adjust-brightness-dst" width="320" height="320" ></canvas>

	<script type="text/javascript">
		function imageAdjustBrightnessRun(){
			var brightness = parseFloat( document.getElementById("image-adjust-brightness-brightness").value );
			runImageThingy( document.getElementById("image-adjust-brightness-src"), document.getElementById("image-adjust-brightness-dst"), function(src){
				return CvLab.image.adjustBrightness( src, brightness );
 			});
		}
		function imageAdjustBrightnessReset(){
			document.getElementById("image-adjust-brightness-brightness").value = 0;
			imageAdjustBrightnessRun();
		}
		document.getElementById("input-image-adjust-brightness").onmousemove = imageAdjustBrightnessRun;
		document.getElementById("image-adjust-brightness-reset").onclick = imageAdjustBrightnessReset;
	</script>
</section>

<!-- image-adjust-contrast.yaml -->

<section id="section-image-adjust-contrast">
	<h2>Adjusts the Contrast</h2>
	<div class="input-parameters-block" id="input-image-adjust-contrast">
		<p>Adds or removes contrast to/from the source image. A postive contrast makes
the image "sharper" while a negative contrast makes the image more "gray".
</p>

		<div class="slider-group">
			<label for="image-adjust-contrast-contrast" title="How much to adjust the contrast">contrast</label>
			<input type="range" id="image-adjust-contrast-contrast" min="-127" max="127" step="1" />
		</div>
		<button id="image-adjust-contrast-reset">Reset</button>

	</div>
	<canvas id="image-adjust-contrast-src" width="320" height="320" ></canvas>
	<canvas id="image-adjust-contrast-dst" width="320" height="320" ></canvas>

	<script type="text/javascript">
		function imageAdjustContrastRun(){
			var contrast = parseFloat( document.getElementById("image-adjust-contrast-contrast").value );
			runImageThingy( document.getElementById("image-adjust-contrast-src"), document.getElementById("image-adjust-contrast-dst"), function(src){
				return CvLab.image.adjustContrast( src, contrast );
 			});
		}
		function imageAdjustContrastReset(){
			document.getElementById("image-adjust-contrast-contrast").value = 0;
			imageAdjustContrastRun();
		}
		document.getElementById("input-image-adjust-contrast").onmousemove = imageAdjustContrastRun;
		document.getElementById("image-adjust-contrast-reset").onclick = imageAdjustContrastReset;
	</script>
</section>

<!-- image-adjust-rgba.yaml -->

<section id="section-image-adjust-rgba">
	<h2>Adjusts the RGBA Values</h2>
	<div class="input-parameters-block" id="input-image-adjust-rgba">
		<p>Adds or subtracts the specified red, green, blue, and alpha values to each
pixel of the source image.
</p>

		<div class="slider-group">
			<label for="image-adjust-rgba-r" title="How much to adjust the red">r</label>
			<input type="range" id="image-adjust-rgba-r" min="-255" max="255" step="1" />
		</div>

		<div class="slider-group">
			<label for="image-adjust-rgba-g" title="How much to adjust the green">g</label>
			<input type="range" id="image-adjust-rgba-g" min="-255" max="255" step="1" />
		</div>

		<div class="slider-group">
			<label for="image-adjust-rgba-b" title="How much to adjust the blue">b</label>
			<input type="range" id="image-adjust-rgba-b" min="-255" max="255" step="1" />
		</div>

		<div class="slider-group">
			<label for="image-adjust-rgba-a" title="How much to adjust the alpha">a</label>
			<input type="range" id="image-adjust-rgba-a" min="-255" max="255" step="1" />
		</div>
		<button id="image-adjust-rgba-reset">Reset</button>

	</div>
	<canvas id="image-adjust-rgba-src" width="320" height="320" ></canvas>
	<canvas id="image-adjust-rgba-dst" width="320" height="320" ></canvas>

	<script type="text/javascript">
		function imageAdjustRgbaRun(){
			var r = parseFloat( document.getElementById("image-adjust-rgba-r").value );
			var g = parseFloat( document.getElementById("image-adjust-rgba-g").value );
			var b = parseFloat( document.getElementById("image-adjust-rgba-b").value );
			var a = parseFloat( document.getElementById("image-adjust-rgba-a").value );
			runImageThingy( document.getElementById("image-adjust-rgba-src"), document.getElementById("image-adjust-rgba-dst"), function(src){
				return CvLab.image.adjustRgba( src, r, g, b, a );
 			});
		}
		function imageAdjustRgbaReset(){
			document.getElementById("image-adjust-rgba-r").value = 0;
			document.getElementById("image-adjust-rgba-g").value = 0;
			document.getElementById("image-adjust-rgba-b").value = 0;
			document.getElementById("image-adjust-rgba-a").value = 0;
			imageAdjustRgbaRun();
		}
		document.getElementById("input-image-adjust-rgba").onmousemove = imageAdjustRgbaRun;
		document.getElementById("image-adjust-rgba-reset").onclick = imageAdjustRgbaReset;
	</script>
</section>

<!-- image-convert-rgba-to-hsva.yaml -->

<section id="section-image-convert-rgba-to-hsva">
	<h2>Convert RGBA To HSVA</h2>
	<div class="input-parameters-block" id="input-image-convert-rgba-to-hsva">
		<p>Converts an image whose 4 channels represent: red, green, blue and alpha to an image whose 4 channels represent: hue, saturation, value and alpha.
</p>
		<button id="image-convert-rgba-to-hsva-reset">Reset</button>

	</div>
	<canvas id="image-convert-rgba-to-hsva-src" width="320" height="320" ></canvas>
	<canvas id="image-convert-rgba-to-hsva-dst" width="320" height="320" ></canvas>

	<script type="text/javascript">
		function imageConvertRgbaToHsvaRun(){
			runImageThingy( document.getElementById("image-convert-rgba-to-hsva-src"), document.getElementById("image-convert-rgba-to-hsva-dst"), function(src){
				return CvLab.image.convertRgbaToHsva( src );
 			});
		}
		function imageConvertRgbaToHsvaReset(){
			imageConvertRgbaToHsvaRun();
		}
		document.getElementById("input-image-convert-rgba-to-hsva").onmousemove = imageConvertRgbaToHsvaRun;
		document.getElementById("image-convert-rgba-to-hsva-reset").onclick = imageConvertRgbaToHsvaReset;
	</script>
</section>

<!-- channel extract/inject -->
<section id="section-image-channel-extract">
	<h2>Channel Extract/Inject</h2>
	<div class="input-parameters-block" id="input-image-channel-extract">
		<p>Extracts/Inserts individual channels of an image</p>
		<button id="image-channel-extract-reset">Reset</button>

	</div>
	<canvas id="image-channel-extract-src" width="320" height="320" ></canvas>
	<canvas id="image-channel-extract-red" width="320" height="320" ></canvas>
	<canvas id="image-channel-extract-green" width="320" height="320" ></canvas>
	<canvas id="image-channel-extract-blue" width="320" height="320" ></canvas>
	<canvas id="image-channel-extract-alpha" width="320" height="320" ></canvas>

	<script type="text/javascript">
		function showChannel( pxSrc, canvas, channel ){
			var ctx = canvas.getContext('2d');
			var xSize = canvas.width;
			var ySize = canvas.height;
			ctx.fillRect(0,0,xSize,ySize);
			var pix = ctx.getImageData( 0,0, xSize, ySize );
			var extracted = CvLab.image.channelExtract( pxSrc, channel );
			console.info( extracted );
			pix = CvLab.image.channelInject( extracted, pix, channel );
			ctx.putImageData(pix,0,0);
		}

		function imageChannelExtractRun(){
			var cvs = document.getElementById("image-channel-extract-src");
			var ctx = cvs.getContext("2d");
			var pxSrc = ctx.getImageData(0,0,cvs.width,cvs.height);

			showChannel( pxSrc, document.getElementById("image-channel-extract-red"), 0 );
			showChannel( pxSrc, document.getElementById("image-channel-extract-green"), 1 );
			showChannel( pxSrc, document.getElementById("image-channel-extract-blue"), 2 );
			showChannel( pxSrc, document.getElementById("image-channel-extract-alpha"), 3 );
		}
		function imageChannelExtractReset(){
			imageChannelExtractRun();
		}
		document.getElementById("input-image-channel-extract").onmousemove = imageChannelExtractRun;
		document.getElementById("image-channel-extract-reset").onclick = imageChannelExtractReset;
	</script>
</section>
