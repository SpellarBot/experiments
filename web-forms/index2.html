<!DOCTYPE html>
<html >
<head>
	<meta charset="utf-8">
	<title>Web Forms</title>
	<meta name="description" content="Web Forms">
	<meta name="author" content="Andrew Ippoliti">

	<!-- IN ANDROID BROWSER - enter "about:debug" in the address bar
	     It should give you some extra options and a 'js console' -->

	<!-- Mobile viewport optimization http://goo.gl/b9SaQ -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=320, height=320, user-scalable=no" />
	
	<!-- Hide browser chrome (iOS only) -->
	<meta name="apple-mobile-web-app-capable" content="yes" />	
        <link rel="stylesheet" href="font-awesome/font-awesome.min.css">
	<link rel="stylesheet" href="./style.css" />
	<style type="text/css"></style>

</head>
<body style="position: relative;" class="lite">
	<div id='toast-container'></div>
	<div class='action-bar' id="action-bar">
		<h1>Web Forms</h1>
		<div class="btn right"><i class='icon-reorder right'></i></div>
		<div class="btn right"><i class='icon-pencil right'></i></div>
		<div class="btn right"><i class='icon-remove right'></i></div>
		<div class='main'>
			<a class='link-button' href='#'><i class='icon-chevron-left'></i> Back</a>
			<a class='link-button' href='#'>Settings</a>
			<a class='link-button' href='#'>BLAH!</a>
		</div>
	</div>
	<div class='main'>
		<p>This is my attempt to make a user interface that looks/behaves/works well for mobile, desktop, accessible and bigger browsers. The only thing I'm not sure of is right-to-left text...</p>
		<p>Let's start with some generic links to 'the next level in the app heirarchy'. I begin the section with a h2 tag. Then I enclose the section in a div with class="section".</p>
		<h2 >SECTION-TITLE</h2>
		<div class='section'>
			<a class='link-button' href='addition/index.htm'>Addition</a>
			<a class='link-button' href='addition/index.htm'>Subtraction</a>
			<a class='link-button' href='addition/index.htm'>Multiplication</a>
			<a class='link-button' href='addition/index.htm'>Division</a>
			<a class='link-button' href='about/index.htm'><i class='icon-info-sign '></i> About</a>
			<a class='link-button' href='somthing.htm' class='multi-line'>
				<i class='icon-info-sign multi-line-icon'></i>
				<div class="primary">About</div>
				<div class="secondary">Who created this, license, etc...</div>
			</a>
		</div>
		<p>You can also create some very nice forms. I try to design my forms with the following in mind.</p>
		<p>Use `select` objects instead of radio buttons. Radio buttons take up too much space. When select objects are used properly on mobile devices the native browser provides a much smoother interaction.</p>
		<p>Put all of the check boxes at the beginning or end of your form. The check boxes prevent the previous/next options when entering data in mobile devices.</p>
		<p>It doesn't hurt to use two lines of text to describe what input you want. Be breif and clear.</p>

		<h2 >Form</h2>
		<div class='section'>
			<div class='input-line'>
				<label for="in-min" id="in-min-label" class="multi-line">
					<div class="primary">Minimum:</div>
					<div class="secondary">The lowest number you want</div>
				</label>
				<input type="number" min="0" max="998" id="in-min" placeholder="0-998"/>
			</div>
			<div class='input-line'>
				<label for="in-max" id="in-max-label">Maximum:</label>
				<input type="number" min="0" max="998" id="in-max" placeholder="0-998"/>
			</div>
			<div class='input-line'>
				<label for="in-max" id="in-other-label">Other:</label>
				<input type="number" min="0" max="998" id="in-other" placeholder="0-998"/>
			</div>

			<div class='input-line'>
			<label for="sel-2" id="sel-2-label">Month</label>
			<select id='sel-2'>
				<option>January</option>
				<option>February</option>
				<option>March</option>
				<option>April</option>
				<option>May</option>
				<option>June</option>
				<option>July</option>
				<option>August</option>
				<option>September</option>
				<option>October</option>
				<option>November</option>
				<option>December</option>
			</select>
			</div>

			<div class='input-line'>
			<label for="sel-3" id="sel-3-label" class="multi-line">
				<div class="primary">Color</div>
				<div class="secondary">Choose your favorite</div>
			</label>
			<select id='sel-3'>
				<option>Red</option>
				<option>Green</option>
				<option>Blue</option>
				<option>Yellow</option>
				<option>Purple</option>
			</select>
			</div>

			<div class='input-line'>
				<label for="in-yes" id="in-yes-label">Yes?</label>
				<input type="checkbox" id="in-yes" value="yes" class="checkbox" />
			</div>
			<div class='input-line'>
				<label for="in-another" id="in-another-label" class="multi-line">
					<div class="primary">Enable this too?</div>
					<div class="secondary">This does: blah!</div>
				</label>
				<input type="checkbox" id="in-another" value="another" class="checkbox" />
			</div>
			<div class='input-line'>
				<label for="in-check-3" id="in-check-3-label" class="multi-line">
					<div class="primary">Enable GPS</div>
					<div class="secondary">Let satelites know where you are</div>
				</label>
				<input type="checkbox" id="in-check-3" value="check-3" class="checkbox" />
			</div>


		</div>

		<h2 >JS Made Form</h2>
		<div class='section' id='test-out'>
		</div>

		<p>I also added "toasts" which are little (or big) messages that are displayed to the user for a breif period of time. Click the buttons below to try them.</p>
		<p>You may be tempted to change the 'position: absolute' to 'position: fixed' in '#toast-container', DON'T! It will mess up the way mobile forms are handled.</p>

		<h2 >Toasts</h2>
		<div class='section'>
			<a class='link-button' href='javascript:Toast("Warning","You may have messed something up.","warn",5000);'>Show Warning</a>
			<a class='link-button' href='javascript:Toast("Error","Wow, you are really gonna get it now.","error",5000);'>Show Error</a>
			<a class='link-button' href='javascript:Toast("I thought you would like to know","I am trying to fix your mess.","info",5000);'>Show Info</a>
			<a class='link-button' href='javascript:Toast("You are welcome","Yeah, I fixed it.","success",5000);'>Show Success</a>
			<a class='link-button' href='javascript:Toast("A Generic Title","A generic message","message",10000);'>Show Generic</a>
		</div>

		<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam dignissim bibendum varius. Maecenas neque eros, tincidunt eu mattis ut, accumsan at purus. Nulla leo justo, blandit eu rhoncus et, sollicitudin eget velit. Sed in vulputate libero. Nunc in eros ante. Donec arcu orci, interdum quis pretium ut, tempor nec odio. Nunc eget nunc sit amet urna fermentum lobortis ac eget eros. Curabitur eu justo enim. Pellentesque at enim augue. Ut suscipit, augue at rutrum faucibus, enim nulla suscipit purus, eu facilisis turpis nulla eu odio.</p>

	</div>

	<div class='navigation-bar'>
	</div>

<script type="text/my-template" id="template-input-text">
	<div class='input-line'>
		<label for="in-%id%" id="in-%id%-label" class="multi-line">
			<div class="primary">%primary%</div>
			<div class="secondary">%secondary%</div>
		</label>
		<input id="in-%id%" type="%type%" placeholder="e.g. %placeholder%" />
	</div>
</script>
<script type="text/my-template" id="template-input-checkbox">
	<div class='input-line'>
		<label for="in-%id%" id="in-%id%-label" class="multi-line">
			<div class="primary">%primary%</div>
			<div class="secondary">%secondary%</div>
		</label>
		<input id="in-%id%" type="%type%" value="%value%" class="checkbox" />
	</div>
</script>

<script type="text/my-template" id="template-input-number">
	<div class='input-line'>
		<label for="in-%id%" id="in-%id%-label" class="multi-line">
			<div class="primary">%primary%</div>
			<div class="secondary">%secondary%</div>
		</label>
		<input id="in-%id%" type="%type%" min="%?min%" max="%?max%" step="%?step%" placeholder="e.g. %placeholder%" />
	</div>
</script>

<script type="text/my-template" id="template-input-select">
	<div class='input-line'>
		<label for="in-%id%" id="in-%id%-label" class="multi-line">
			<div class="primary">%primary%</div>
			<div class="secondary">%secondary%</div>
		</label>
		<select id="in-%id%">[
			<option>%options%</option>]
		</select>
	</div>
</script>

<script type="text/javascript">
function is_number(x){
	return (! isNaN(x));
}
function is_regexp(x){
	return x instanceof RegExp;
}
function is_array(x){
	return x instanceof Array;
}

function template(template_id,replacements){
	var html = document.getElementById(template_id).innerHTML;

	// replace all of the allowed stuff...
	var prop, arr_match, regexp, i,l, lines, full_line, clean_line;
	for( prop in replacements ){
		if( replacements.hasOwnProperty(prop) ){

			// When replacing arrays: The array'ed template
			// fragment is enclosed in [...]
			// I use these for select/option inputs
			if( is_array(replacements[prop]) ){

				// Find the array area then create multiple copies
				// of it for the number of items we have

				regexp = new RegExp('\\[([\\s\\S]+?'+'%'+prop+'%'+'[\\s\\S]+?)\\]','g');
				arr_match = regexp.exec(html);
				full_line = arr_match[0];
				clean_line = arr_match[1];
				lines = '';
				l = replacements[prop].length;

				for( i=0; i<l; i+=1 ){
					// For URL parms I let `|` separate synonyms
					// For select/options I only show the first one
					lines += clean_line.replace('%'+prop+'%',replacements[prop][i].split('|')[0]);
				}

				html = html.replace(full_line,lines);
			}else{
				// This the regular one, %value% or %?value%
				html = html.replace(new RegExp('%\\??'+prop+'%','g'), replacements[prop]);
			}
		}
	}

	// Remove all of the optional stuff that has been left out
	// optional stuff has a `?` after the 1st `%` ie %?name% is optional
	html = html.replace(new RegExp('[^ ]+?'+'%'+'\\?[^ ]+'+'%'+'[^ ]+?','g'), '');
	
	return html;
}

function make_default_options(options){
	var defaults = {};
	var i, l = options.length;
	for( i=0; i<l; i+=1 ){
		defaults[options[i].id] = options[i].value;
	}
	return defaults;
}

function make_template_form(template_prefix,options){
	var html = '';
	var i, l = options.length;
	for( i=0; i<l; i+=1 ){
		html += template(template_prefix + options[i].type, options[i])
	}
	return html;
}

function read_url_parms(options){
	/// Parses the URL for parameters and returns an array of key-value pairs
	// An exmaple url: http://example.com/index.htm?key1=val1&key2=val2

	var results = {};

	// URL parameters begin after '?' in the URL.
	// If it's not there, just return the defaults
	var startLocation = window.location.href.indexOf('?');
	if( startLocation === -1 ){ return defaults; }
	var parmString = window.location.href.slice(startLocation + 1);

	// Each key/value pair is separated by an '&'.
	var varStrings = parmString.split('&');

	// We need to iterate over each key/value string.
	var i,l = varStrings.length;
	var variables = {};
	for( i=0; i<l; i+=1 ){

		// Key/value strings have the form: key=value
		var tmp = varStrings[i].split('=');

		// We need to unescape the strings because they be encoded as follows:
		// "hello world" -> hello+world
		// or certain charactes are encoded as their ascii value: %20 %da
		// We also convert the key to lower case so the program can always
		// access via the lower case key.
		results[unescape(tmp[0]).toLowerCase()] = unescape(tmp[1]);
	}

	// Add the stuff we're missing and sanitize all inputs
	var id, value, j, k, tmp, opts, isOk;
	l = options.length;
	for( i=0; i<l; i+=1 ){
		id = options[i].id;
		
		// Use the default unless the user has supplied a value
		value = options[i].value;
		if( results.hasOwnProperty(id) ){
			value = results[id];
		}

		// Handle yes/no checkboxes specially
		if( options[i].type === 'checkbox' ){
			tmp = (''+value).toLowerCase();
			if( value === 'yes' || value === 'y' || value === '1' || value === 'on' || value === '' ){
				value = true;
			}
			if( value === 'no' || value === 'no' || value === '0' || value === 'off' ){
				value = false;
			}
		}

		// Force select options to the dominant one
		if( options[i].type === 'select' ){

			j = options[i].options.length;
			isOk = 0;
			while( j-- ){
				opts = options[i].options[j].split('|');
				k = opts.length;
				while( k-- ){
					if( opts[k] === value ){
						value = opts[0];
						k = 0; // break the loop
						j = 0; // break the loop
						isOk = 1;
					}
				}
			}

			// If it wasn't a valid selection option, set the default
			if( ! isOk ){
				value = options[i].value;
			}
		}
		
		// Convert the value if a conversion function was provided
		// otherwise, just use the value
		if( options[i].convert ){
			results[id] = options[i].convert(value);
		}else{
			results[id] = value;
		}
		
	}

	return results;
}

function read_form_data(options){

	var results = {}, dom_id, prop, dom, value;
	var i, l = options.length;
	for( i=0; i<l; i+=1 ){

		// Find the corresponding dom node, based on the id
		prop = options[i].id;
		dom_id = 'in-'+prop;
		dom = document.getElementById(dom_id);

		// Get the user's input or use the default value
		value = options[i].value;
		if( dom.value !== '' ){
			value = dom.value;
		}

		// The `value` attribute of a checkbox has no meaning
		// we need to check the `checked` attribute
		if( dom.type === 'checkbox' ){
			value = ( !! dom.checked );
		}

		// Convert the value if a conversion function was provided
		// otherwise, just use the value
		if( options[i].convert ){
			results[prop] = options[i].convert(value);
		}else{
			results[prop] = value;
		}

	}

	return results;
}

var form = [{
	id: 'function',
	type: 'text',
	primary: 'Function:',
	secondary: 'Enter a function',
	placeholder: '0.5*x+2',
	convert: function(value){ var y; eval("y = function(x){ return "+value+"; };"); return y; },
	value: function(){return 0.5*x+2;}
}, {
	id: 'x_min',
	type: 'number',
	primary: 'X Minimum:',
	secondary: 'The lowest value for x',
	placeholder: '0',
	convert: parseFloat,
	value: 0,
	min: 200
}, {
	id: 'color',
	type: 'select',
	primary: 'Color:',
	secondary: 'Select your favorite',
	options: ['red|rose','blue|violet','green|lime'],
	value: 'red'
}, {
	id: 'is_big',
	type: 'checkbox',
	primary: 'Is Big:',
	secondary: 'Is this code to big?',
	value: false
} ];
console.info(make_default_options(form));

document.getElementById('test-out').innerHTML = make_template_form('template-input-',form);
setTimeout( function(){
	console.info( read_form_data(form) );
	console.info( read_url_parms(form) );
}, 5000);

function Toast(title,message,cssClass,duration){
	var primary = document.createElement('div');
	primary.className = "primary";
	primary.appendChild(document.createTextNode(title));
	var secondary = document.createElement('div');
	secondary.className = "secondary";
	secondary.appendChild(document.createTextNode(message));
	var box = document.createElement('div');
	box.className = "toast initial-toast";
	box.appendChild(primary);
	box.appendChild(secondary);
	var container = document.getElementById('toast-container');
	var top = Math.max(document.documentElement.scrollTop,document.body.scrollTop);
	container.style.top = top+'px';
	
	// Insert this node 'at the top'
	// IE requires a valid node or null
	var before = container.childNodes[0];
	if( container.childNodes.length < 1 ){ before = null; }
	container.insertBefore(box,before);

	// Trick the browser into animating
	setTimeout(function(){
		box.className = "toast "+cssClass;
	},0);
	setTimeout(function(){
		box.style.opacity = 0;
		setTimeout(function(){
			document.getElementById('toast-container').removeChild(box);
			box = null;
		},400);
	},duration);
}
document.getElementById('action-bar').onclick = function(){
	var actionBar = document.getElementById('action-bar');
	if( actionBar.style.maxHeight === '10em' ){
		actionBar.style.maxHeight = '1em';
	}else{
		actionBar.style.maxHeight = '10em';
	}
	actionBar = null;
};
/*
setTimeout(function(){Toast("Message","This is a test","message",5000);},500);
setTimeout(function(){Toast("Information","This is a test","info",5000);},1000);
setTimeout(function(){Toast("Warning","This is a test","warn",5000);},2000);
setTimeout(function(){Toast("Error","This is a test","error",5000);},2500);
setTimeout(function(){Toast("Success","This is a test","success",5000);},3000);
*/
</script>
</body>
</html>
